<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swastik AI</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Saira+Stencil+One&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        :root {
            --bg-body: #09090a;
            --bg-glass: rgba(30, 31, 32, 0.75);
            --bg-glass-border: rgba(255, 255, 255, 0.08);
            --text-primary: #f0f0f0;
            --text-secondary: #9aa0a6;
            --accent-blue: #a8c7fa;
            --accent-glow: rgba(168, 199, 250, 0.2);
            --accent-red: #ff8989;
            --font-main: 'Inter', sans-serif;
            --font-brand: 'Saira Stencil One', cursive;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background: var(--bg-body);
            background-image: radial-gradient(circle at 50% 0%, #1a1b1e 0%, #000 70%);
            color: var(--text-primary);
            font-family: var(--font-main);
            height: 100vh;
            overflow: hidden;
        }

        /* --- 1. INTRO & FLASH --- */
        #intro-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }

        .curtain {
            position: absolute;
            left: 0;
            width: 100%;
            height: 51%;
            background: #000;
            z-index: 1;
            transition: transform 1.2s cubic-bezier(0.8, 0, 0.1, 1);
            will-change: transform;
        }

        .top-curtain {
            top: 0;
            transform-origin: top;
        }

        .bottom-curtain {
            bottom: 0;
            transform-origin: bottom;
        }

        .intro-content {
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: opacity 0.4s ease;
        }

        #flash-overlay {
            position: fixed;
            inset: 0;
            background: #fff;
            z-index: 6000;
            opacity: 0;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        .flash-active {
            animation: flash-bang 0.8s ease-out forwards;
        }

        @keyframes flash-bang {
            0% {
                opacity: 0;
            }

            10% {
                opacity: 1;
                background: #a8c7fa;
            }

            100% {
                opacity: 0;
            }
        }

        .brand-lockup {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Intro Logo with Rotation */
        .intro-logo {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 0 20px rgba(66, 133, 244, 0.5));
            animation: spinLogo 4s linear infinite;
            /* ROTATION ADDED HERE */
        }

        @keyframes spinLogo {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .brand-title {
            font-family: var(--font-brand);
            font-size: 4rem;
            margin: 0;
            letter-spacing: 4px;
            background: linear-gradient(to right, #fff, #a8c7fa);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .accent-red {
            color: var(--accent-red);
            -webkit-text-fill-color: var(--accent-red);
            text-shadow: 0 0 15px rgba(255, 59, 59, 0.4);
        }

        .loader-bar {
            width: 200px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }

        .loader-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
            animation: loadScan 1.5s infinite;
        }

        @keyframes loadScan {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        body.loaded .top-curtain {
            transform: translateY(-100%);
        }

        body.loaded .bottom-curtain {
            transform: translateY(100%);
        }

        body.loaded .intro-content {
            opacity: 0;
        }

        /* --- 2. AUTH --- */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 5000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .auth-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .auth-box {
            background: rgba(20, 21, 22, 0.85);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            width: 100%;
            max-width: 400px;
            border-radius: 24px;
            text-align: center;
            border: 1px solid var(--bg-glass-border);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .input-wrapper input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            color: #fff;
            transition: 0.3s;
        }

        .input-wrapper input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .primary-btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-blue), #7b9add);
            color: #000;
            border: none;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(168, 199, 250, 0.4);
        }

        .switch-auth {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #888;
            cursor: pointer;
        }

        .switch-auth span {
            color: var(--accent-blue);
        }

        /* --- 3. LAYOUT --- */
        .app-wrapper {
            display: flex;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        /* Sidebar */
        .sidebar {
            width: 72px;
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--bg-glass-border);
            display: flex;
            flex-direction: column;
            padding: 20px 10px;
            transition: width 0.4s cubic-bezier(0.2, 0, 0, 1);
            overflow: hidden;
            white-space: nowrap;
            z-index: 50;
        }

        .sidebar:hover {
            width: 260px;
            background: rgba(30, 31, 32, 0.95);
        }

        .menu-top {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-icon {
            padding: 10px;
            color: var(--text-secondary);
            text-align: center;
        }

        .new-chat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: 0.3s;
            height: 48px;
            border: 1px solid transparent;
            overflow: hidden;
        }

        .nav-text {
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        .sidebar:hover .nav-text {
            opacity: 1;
        }

        .sidebar:hover .new-chat-item {
            border-color: var(--accent-blue);
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }

        .history-section {
            flex: 1;
            margin-top: 30px;
            overflow-y: auto;
            opacity: 0;
            transition: 0.2s;
        }

        .sidebar:hover .history-section {
            opacity: 1;
        }

        .section-label {
            font-size: 0.75rem;
            color: #555;
            margin-bottom: 10px;
            padding-left: 10px;
            letter-spacing: 1px;
        }

        .menu-bottom {
            margin-top: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            color: var(--accent-red);
            cursor: pointer;
            border-radius: 12px;
        }

        .nav-item:hover {
            background: rgba(255, 89, 89, 0.1);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: transparent;
        }

        /* --- 4. TOP BAR & NAV --- */
        .top-bar {
            height: 70px;
            padding: 0 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--bg-glass-border);
            z-index: 100;
        }

        .brand-mini {
            display: flex;
            align-items: center;
            gap: 20px;
            height: 100%;
        }

        .nav-brand-text {
            font-family: var(--font-brand);
            font-size: 1.2rem;
            letter-spacing: 1px;
            color: #fff;
            margin-right: 20px;
        }

        /* Mini Logo in Top Bar */
        .nav-logo {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 0 10px rgba(168, 199, 250, 0.4));
        }

        .top-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* --- Mode Dropdown --- */
        .custom-dropdown {
            position: relative;
        }

        .dropdown-trigger {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--bg-glass-border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-family: var(--font-main);
            transition: 0.2s;
        }

        .dropdown-trigger:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #555;
        }

        /* Dedicated Mode Menu Class */
        .mode-menu {
            position: absolute;
            top: 120%;
            left: 0;
            width: 180px;
            background: #1e1f20;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 101;
            animation: scaleIn 0.2s ease;
        }

        .custom-dropdown.open .mode-menu {
            display: flex;
        }

        .menu-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .menu-item.active {
            color: var(--accent-blue);
            background: rgba(168, 199, 250, 0.05);
        }

        /* Model Selects */
        .nav-select {
            background: transparent;
            border: 1px solid transparent;
            color: #9aa0a6;
            padding: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-family: var(--font-main);
        }

        .nav-select:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-select option,
        .nav-select optgroup {
            background: #1e1f20;
            color: #fff;
        }

        .vs-badge {
            font-weight: 800;
            font-style: italic;
            color: var(--accent-red);
            margin: 0 5px;
        }

        /* --- User Profile & Right Dropdown --- */
        .user-profile {
            position: relative;
            cursor: pointer;
            margin-left: auto;
        }

        .avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #4285f4, #d96570);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s;
        }

        .user-profile:hover .avatar {
            border-color: var(--accent-blue);
            transform: scale(1.05);
        }

        /* Profile Dropdown specific styling */
        .profile-dropdown-menu {
            position: absolute;
            top: 50px;
            right: 0;
            width: 240px;
            background: #1e1f20;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 200;
            transform-origin: top right;
            animation: scaleIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .user-profile.active .profile-dropdown-menu {
            display: flex;
        }

        .dropdown-header {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-name {
            display: block;
            font-weight: 600;
            color: #fff;
        }

        .user-email {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-top: 4px;
        }

        .dropdown-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ccc;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .dropdown-item.logout {
            color: var(--accent-red);
        }

        .dropdown-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.08);
            margin: 4px 0;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* --- 5. CHAT AREA --- */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px 15%;
            display: flex;
            flex-direction: column;
            gap: 25px;
            scroll-behavior: smooth;
        }

        .welcome-screen {
            text-align: center;
            margin-top: 10vh;
        }

        .welcome-text {
            font-size: 3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fff;
            letter-spacing: -1px;
        }

        .sub-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .gradient-text {
            background: linear-gradient(120deg, #4285f4, #d96570);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Messages */
        .message.user {
            align-self: flex-end;
            max-width: 70%;
        }

        .message.user div {
            background: linear-gradient(135deg, #303134, #28292a);
            padding: 14px 20px;
            border-radius: 20px 20px 4px 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: #f0f0f0;
        }

        .message.bot {
            align-self: flex-start;
            max-width: 80%;
        }

        .message.bot div {
            line-height: 1.6;
            color: #e3e3e3;
        }

        /* Compare Grid */
        .arena-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }

        .bot-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 15px;
        }

        .bot-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-blue);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- 6. INPUT AREA --- */
        .input-container {
            padding: 0 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 50;
            background: linear-gradient(to top, var(--bg-body) 20%, transparent);
        }

        .input-box {
            width: 100%;
            max-width: 800px;
            background: rgba(30, 31, 32, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border: 1px solid var(--bg-glass-border);
            transition: 0.3s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .input-box:focus-within {
            border-color: var(--accent-blue);
            box-shadow: 0 10px 40px var(--accent-glow);
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1rem;
            padding: 0 15px;
            height: 30px;
        }

        .icon-btn {
            color: var(--text-secondary);
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            transition: 0.2s;
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .send-active {
            color: var(--accent-blue);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .chat-area {
                padding: 20px 5%;
            }

            .top-bar {
                padding: 0 15px;
            }

            .auth-box {
                width: 90%;
            }

            .arena-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div id="intro-screen">
        <div class="curtain top-curtain"></div>
        <div class="curtain bottom-curtain"></div>
        <div class="intro-content">
            <div class="brand-lockup">
                <img src="/static/logo.svg" alt="Swastik AI Logo" class="intro-logo">
                <h1 class="brand-title">SWASTIK <span class="accent-red">AI</span></h1>
            </div>
            <div class="loader-bar"></div>
        </div>
    </div>

    <div id="flash-overlay"></div>

    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-box">
            <!-- <img src="/static/logo.svg" alt="Logo" -->
            <!-- style="width: 60px; height: 60px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(66, 133, 244, 0.5));"> -->
            <h2 id="auth-title" style="margin-top:0;">Sign in</h2>
            <p style="color: #888;">Welcome to the Neural Network</p>

            <div id="login-form">
                <div class="input-wrapper"><input type="email" id="l-email" placeholder="Email" required></div><br>
                <div class="input-wrapper"><input type="password" id="l-password" placeholder="Password" required></div>
                <br>
                <button id="login-btn" class="primary-btn">LOG IN</button><br>
                <div class="switch-auth">No access? <span id="to-signup">Create account</span></div>
            </div>

            <div id="signup-form" style="display:none;">
                <div class="input-wrapper"><input type="text" id="s-username" placeholder="Username" required></div><br>
                <div class="input-wrapper"><input type="email" id="s-email" placeholder="Email" required></div><br>
                <div class="input-wrapper"><input type="password" id="s-password" placeholder="Password" required></div>
                <br>
                <button id="register-btn" class="primary-btn">REGISTER NODE</button><br>
                <div class="switch-auth">Exists? <span id="to-login">Sign in</span></div>
            </div>
            <p id="auth-msg" style="margin-top: 15px; font-size: 0.9rem;"></p>
        </div>
    </div>

    <div id="app-wrapper" class="app-wrapper">

        <nav class="sidebar">
            <div class="menu-top">
                <div class="menu-icon"><span class="material-symbols-outlined">menu</span></div>
                <div class="new-chat-item" id="new-chat-btn">
                    <span class="material-symbols-outlined">add</span>
                    <span class="nav-text">New Chat</span>
                </div>
            </div>
            <div class="history-section">
                <div class="section-label">MEMORY LOGS</div>
                <div id="history-list">
                </div>
            </div>
            <div class="menu-bottom">
                <div class="nav-item" id="logout-btn">
                    <span class="material-symbols-outlined">power_settings_new</span>
                    <span class="nav-text">Disconnect</span>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <header class="top-bar">

                <div class="brand-mini">
                    <img src="/static/logo.svg" alt="Swastik AI" class="nav-logo">
                    <span class="nav-brand-text">SWASTIK</span>

                    <div class="top-controls">
                        <div class="custom-dropdown" id="mode-dropdown">
                            <button class="dropdown-trigger">
                                <span class="material-symbols-outlined" id="mode-icon">chat</span>
                                <span id="mode-text">Direct</span>
                                <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                            </button>
                            <div class="mode-menu">
                                <div class="menu-item active" onclick="setMode('direct')"><span
                                        class="material-symbols-outlined">chat</span> Direct</div>
                                <div class="menu-item" onclick="setMode('compare')"><span
                                        class="material-symbols-outlined">splitscreen</span> Compare<p></div>
                                <div class="menu-item" onclick="setMode('battle')"><span
                                        class="material-symbols-outlined">swords</span> Battle</div>
                            </div>
                        </div>

                        <div class="model-selectors" id="model-controls"
                            style="display: flex; align-items: center; gap: 5px;">
                            <select id="model-a" class="nav-select">
                                <optgroup label="Google">
                                    <option value="gemini-2.0-flash" selected>Gemini 2.0 Flash</option>
                                </optgroup>
                                <optgroup label="Groq (Super Fast)">
                                    <option value="llama-3.3-70b">Llama 3.3 70B</option>
                                    <option value="mixtral-8x7b">Mixtral 8x7B</option>
                                    <option value="gemma-2-9b">Gemma 2 9B</option>
                                </optgroup>
                                <optgroup label="SambaNova">
                                    <option value="deepseek-r1">DeepSeek R1</option>
                                    <option value="llama-3.1-405b">Llama 3.1 405B</option>
                                </optgroup>
                                <optgroup label="GitHub Models">
                                    <option value="gpt-4o">GPT-4o</option>
                                    <option value="phi-4">Phi-4</option>
                                    <option value="cohere-command">Cohere Command</option>
                                </optgroup>
                                <optgroup label="Other Providers">
                                    <option value="mistral-large">Mistral Large</option>
                                    <option value="qwen-2.5">Qwen 2.5</option>
                                </optgroup>
                            </select>

                            <span id="vs-badge" class="vs-badge" style="display:none">VS</span>

                            <select id="model-b" class="nav-select" style="display:none">
                                <optgroup label="Google">
                                    <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                </optgroup>
                                <optgroup label="Groq (Super Fast)">
                                    <option value="llama-3.3-70b" selected>Llama 3.3 70B</option>
                                    <option value="mixtral-8x7b">Mixtral 8x7B</option>
                                    <option value="gemma-2-9b">Gemma 2 9B</option>
                                </optgroup>
                                <optgroup label="SambaNova">
                                    <option value="deepseek-r1">DeepSeek R1</option>
                                    <option value="llama-3.1-405b">Llama 3.1 405B</option>
                                </optgroup>
                                <optgroup label="GitHub Models">
                                    <option value="gpt-4o">GPT-4o</option>
                                    <option value="phi-4">Phi-4</option>
                                    <option value="cohere-command">Cohere Command</option>
                                </optgroup>
                                <optgroup label="Other Providers">
                                    <option value="mistral-large">Mistral Large</option>
                                    <option value="qwen-2.5">Qwen 2.5</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="user-profile" id="profile-trigger">
                    <div class="avatar" id="user-avatar">A</div>
                    <div class="profile-dropdown-menu">
                        <div class="dropdown-header">
                            <span class="user-name" id="display-username">User</span>
                            <span class="user-email">Pro Plan</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <span class="material-symbols-outlined" style="font-size: 18px;">settings_voice</span> Voice
                            Settings
                        </a>
                        <a href="#" class="dropdown-item">
                            <span class="material-symbols-outlined" style="font-size: 18px;">settings</span> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout" id="logout-action">
                            <span class="material-symbols-outlined" style="font-size: 18px;">logout</span> Log out
                        </a>
                    </div>
                </div>
            </header>

            <div id="chat-window" class="chat-area">
                <div class="welcome-screen">
                    <h1 class="welcome-text">System <span class="gradient-text">Online</span></h1>
                    <p class="sub-text">Awaiting input command...</p>
                </div>
            </div>

            <div class="input-container">
                <div class="input-box">
                    <button class="icon-btn"><span class="material-symbols-outlined">add_circle</span></button>
                    <input type="text" id="user-input" placeholder="Transmit data to Swastik AI...">
                    <button class="icon-btn send-active" id="send-btn"><span
                            class="material-symbols-outlined">send</span></button>
                </div>
            </div>
        </main>
    </div>
    <script>
        const API_URL = "http://localhost:5001";
        let currentUser = null;
        let currentSessionId = null;
        let currentMode = "direct"; // direct, compare, battle

        // --- 1. INITIALIZATION ---
        window.addEventListener('load', () => {
            // Intro Animation Sequence
            setTimeout(() => {
                document.body.classList.add('loaded');
                setTimeout(() => {
                    document.getElementById("intro-screen").style.display = 'none';
                    document.getElementById("auth-overlay").classList.add('active');
                }, 1200);
            }, 3000);
        });

        // --- 2. AUTHENTICATION ---
        document.getElementById("to-signup").onclick = () => toggleAuth('signup');
        document.getElementById("to-login").onclick = () => toggleAuth('login');
        document.getElementById("login-btn").onclick = login;
        document.getElementById("register-btn").onclick = register;
        // Sidebar logout button
        document.getElementById("logout-btn").onclick = () => location.reload();
        // Profile dropdown logout button
        document.getElementById("logout-action").onclick = () => location.reload();

        function toggleAuth(mode) {
            document.getElementById("auth-msg").innerText = "";
            document.getElementById(mode === 'signup' ? "login-form" : "signup-form").style.display = "none";
            document.getElementById(mode === 'signup' ? "signup-form" : "login-form").style.display = "block";
            document.getElementById("auth-title").innerText = mode === 'signup' ? "Create Account" : "Welcome Back";
        }

        async function login() {
            const email = document.getElementById("l-email").value;
            const password = document.getElementById("l-password").value;
            if (!email || !password) return showAuthMsg("Enter credentials", true);

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (res.ok) {
                    currentUser = data;
                    enterApp(data.username);
                } else showAuthMsg(data.error, true);
            } catch (e) { showAuthMsg("Server Offline", true); }
        }

        async function register() {
            const username = document.getElementById("s-username").value;
            const email = document.getElementById("s-email").value;
            const password = document.getElementById("s-password").value;
            if (!username || !email || !password) return showAuthMsg("Fill all fields", true);

            try {
                const res = await fetch(`${API_URL}/register`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, email, password })
                });
                if (res.ok) { toggleAuth('login'); showAuthMsg("Success. Please login.", false); }
                else showAuthMsg("Registration Failed", true);
            } catch (e) { showAuthMsg("Error", true); }
        }

        function showAuthMsg(msg, isErr) {
            const el = document.getElementById("auth-msg");
            el.innerText = msg;
            el.style.color = isErr ? "#ff8989" : "#9cd6a4";
        }

        function enterApp(username) {
            document.getElementById("auth-overlay").classList.remove('active');

            // Flash Effect
            const flash = document.getElementById("flash-overlay");
            flash.classList.add("flash-active");

            setTimeout(() => {
                flash.classList.remove("flash-active");
                document.getElementById("auth-overlay").style.display = 'none';
            }, 800);

            setTimeout(() => {
                document.getElementById("app-wrapper").style.opacity = '1';
            }, 200);

            // Update UI info
            document.getElementById("display-username").innerText = username;
            document.getElementById("user-avatar").innerText = username.charAt(0).toUpperCase();
            document.querySelector(".welcome-text").innerHTML = `Hello, <span class="gradient-text">${username}</span>`;
            fetchHistory();
        }

        // --- 3. UI LOGIC: DROPDOWNS & MODES ---

        // Mode Dropdown Logic
        const modeDropdown = document.getElementById("mode-dropdown");
        const modeTrigger = document.querySelector(".dropdown-trigger");

        modeTrigger.onclick = (e) => {
            e.stopPropagation();
            modeDropdown.classList.toggle("open");
            // Close profile if open
            document.getElementById('profile-trigger').classList.remove('active');
        };

        // Profile Dropdown Logic
        const profileTrigger = document.getElementById('profile-trigger');
        profileTrigger.onclick = (e) => {
            e.stopPropagation();
            profileTrigger.classList.toggle('active');
            // Close mode if open
            modeDropdown.classList.remove("open");
        };

        // Global Click to close all dropdowns
        window.onclick = () => {
            modeDropdown.classList.remove("open");
            profileTrigger.classList.remove('active');
        };

        // New Chat Button Logic
        document.getElementById("new-chat-btn").onclick = () => {
            currentSessionId = null;
            resetChatUI(currentMode);
        };

        // Mode Switching Logic
        window.setMode = (mode) => {
            currentMode = mode;
            currentSessionId = null; // Reset session on mode switch

            const map = {
                'direct': { text: 'Direct', icon: 'chat' },
                'compare': { text: 'Compare', icon: 'splitscreen' },
                'battle': { text: 'Battle', icon: 'swords' }
            };

            // Update Dropdown Text
            document.getElementById("mode-text").innerText = map[mode].text;
            document.getElementById("mode-icon").innerText = map[mode].icon;

            // Toggle Selectors
            const modelA = document.getElementById("model-a");
            const modelB = document.getElementById("model-b");
            const vs = document.getElementById("vs-badge");

            if (mode === 'direct') {
                modelA.style.display = "block";
                modelB.style.display = "none";
                vs.style.display = "none";
            } else if (mode === 'compare') {
                modelA.style.display = "block";
                modelB.style.display = "block";
                vs.style.display = "inline";
            } else {
                // Battle: Hide selectors
                modelA.style.display = "none";
                modelB.style.display = "none";
                vs.style.display = "none";
            }

            resetChatUI(mode);

            // Close Dropdown manually since this is called from onclick
            modeDropdown.classList.remove("open");
        };

        function resetChatUI(mode) {
            const map = {
                'direct': 'Direct Chat',
                'compare': 'Side-by-Side',
                'battle': 'Battle Arena'
            };

            const title = map[mode] || 'System Online';

            document.getElementById("chat-window").innerHTML = `
        <div class="welcome-screen">
            <h1 class="welcome-text">${title}</h1>
            <p class="sub-text">Ready to transmit.</p>
        </div>`;
        }

        // --- 4. CHAT LOGIC ---
        document.getElementById("send-btn").onclick = sendMessage;
        document.getElementById("user-input").addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

        async function sendMessage() {
            const input = document.getElementById("user-input");
            const text = input.value.trim();
            if (!text) return;

            if (document.querySelector(".welcome-screen")) document.getElementById("chat-window").innerHTML = "";

            // 1. User Msg
            addMessage(text, "user");
            input.value = "";

            // 2. Loading
            const loadingId = "load-" + Date.now();
            const loadDiv = document.createElement("div");
            loadDiv.className = "message bot";
            loadDiv.id = loadingId;
            loadDiv.innerHTML = "<div>Thinking...</div>";
            document.getElementById("chat-window").appendChild(loadDiv);
            document.getElementById("chat-window").scrollTop = document.getElementById("chat-window").scrollHeight;

            // 3. Payload
            const payload = {
                user_id: currentUser.user_id,
                session_id: currentSessionId,
                input: text,
                mode: currentMode
            };

            let endpoint = "/agent";
            if (currentMode === 'direct') {
                payload.model = document.getElementById("model-a").value;
            } else {
                endpoint = "/compare";
                payload.model_a = document.getElementById("model-a").value;
                payload.model_b = document.getElementById("model-b").value;
            }

            try {
                const res = await fetch(`${API_URL}${endpoint}`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                document.getElementById(loadingId).remove();

                if (data.session_id) currentSessionId = data.session_id;

                if (currentMode === 'direct') {
                    addMessage(data.response, "bot");
                } else {
                    addSplitMessage(data.response_a, data.model_a, data.response_b, data.model_b);
                }
                fetchHistory();

            } catch (e) {
                if (document.getElementById(loadingId)) document.getElementById(loadingId).remove();
                addMessage("Error connecting to server node.", "bot");
            }
        }

        function addMessage(text, sender) {
            const win = document.getElementById("chat-window");
            const div = document.createElement("div");
            div.className = `message ${sender}`;
            const content = sender === 'bot' ? marked.parse(text) : text;
            div.innerHTML = `<div>${content}</div>`;
            win.appendChild(div);
            if (sender === 'bot') div.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
            win.scrollTop = win.scrollHeight;
        }

        function addSplitMessage(textA, nameA, textB, nameB) {
            const win = document.getElementById("chat-window");
            const div = document.createElement("div");
            div.className = "arena-grid";

            const titleA = currentMode === 'battle' ? "Model A (???)" : nameA;
            const titleB = currentMode === 'battle' ? "Model B (???)" : nameB;

            div.innerHTML = `
        <div class="bot-card">
            <div class="bot-header">${titleA}</div>
            <div>${marked.parse(textA)}</div>
        </div>
        <div class="bot-card">
            <div class="bot-header">${titleB}</div>
            <div>${marked.parse(textB)}</div>
        </div>
    `;
            win.appendChild(div);
            div.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
            win.scrollTop = win.scrollHeight;
        }

        async function fetchHistory() {
            if (!currentUser) return;
            try {
                const res = await fetch(`${API_URL}/history`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_id: currentUser.user_id })
                });
                const sessions = await res.json();
                const list = document.getElementById("history-list");
                list.innerHTML = "";
                sessions.forEach(s => {
                    const div = document.createElement("div");
                    div.className = "history-item"; // You can style this class in CSS
                    div.style.padding = "10px";
                    div.style.cursor = "pointer";
                    div.style.color = "#9aa0a6";
                    div.style.borderBottom = "1px solid rgba(255,255,255,0.05)";
                    div.innerText = s.title || "Untitled Session";
                    div.onclick = () => { /* Load session logic here */ };
                    list.appendChild(div);
                });
            } catch (e) { }
        }
    </script>
</body>

</html>